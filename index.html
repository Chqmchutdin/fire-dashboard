<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏ü‡∏õ‡πà‡∏≤‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&family=Sarabun:wght@300;400;700&display=swap');

        body {
            background: #f8fafc;
            font-family: 'Sarabun', 'Plus Jakarta Sans', sans-serif;
            color: #1e293b;
        }

        #map {
            height: 500px;
            width: 100%;
            border-radius: 1.5rem;
        }

        .dashboard-card {
            background: white;
            border-radius: 2rem;
            border: 1px solid #e2e8f0;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.05);
            padding: 2rem;
            transition: all 0.3s;
        }

        .dashboard-card:hover {
            shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }

        .kpi-label {
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.25rem;
        }
    </style>
</head>

<body class="p-4 md:p-10 text-slate-800">
    <div class="max-w-[1600px] mx-auto">

        <header class="flex flex-col lg:flex-row justify-between items-start lg:items-center mb-10 gap-6">
            <div>
                <h1 class="text-4xl font-black tracking-tight text-slate-900 mb-2">‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÑ‡∏ü‡∏õ‡πà‡∏≤‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏® (‡∏û.‡∏®. 2542 - 2566)</h1>
                <p class="text-slate-500 font-medium text-lg">‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏£‡∏≤‡∏¢‡∏õ‡∏µ ‡∏£‡∏≤‡∏¢‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î ‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏¢‡∏†‡∏π‡∏°‡∏¥‡∏†‡∏≤‡∏Ñ</p>
            </div>
            <div class="flex flex-wrap gap-4">
                <div class="bg-white border-l-8 border-orange-500 px-8 py-5 rounded-2xl shadow-sm min-w-[220px]">
                    <p class="kpi-label text-orange-600">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏¥‡∏î‡πÑ‡∏ü‡∏£‡∏ß‡∏°</p>
                    <div class="flex items-baseline gap-2">
                        <span id="total-times" class="text-3xl font-black">0</span>
                        <span class="text-slate-400 font-bold text-sm text-sarabun">‡∏Ñ‡∏£‡∏±‡πâ‡∏á</span>
                    </div>
                </div>
                <div class="bg-slate-900 px-8 py-5 rounded-2xl shadow-xl min-w-[220px]">
                    <p class="kpi-label text-slate-400">‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡∏¢‡∏´‡∏≤‡∏¢‡∏£‡∏ß‡∏°</p>
                    <div class="flex items-baseline gap-2">
                        <span id="total-rai" class="text-3xl font-black text-white">0</span>
                        <span class="text-slate-400 font-bold text-sm">‡πÑ‡∏£‡πà</span>
                    </div>
                </div>
            </div>
        </header>

        <div class="grid grid-cols-12 gap-8 mb-8">
            <div class="col-span-12 lg:col-span-7 dashboard-card">
                <h3 class="text-xl font-bold mb-6 flex items-center gap-2">üìç ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏∞‡∏™‡∏ö‡∏†‡∏±‡∏¢‡∏£‡∏≤‡∏¢‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</h3>
                <div id="map"></div>
            </div>
            <div class="col-span-12 lg:col-span-5 dashboard-card">
                <h3 class="text-xl font-bold mb-6 italic text-red-600">üèÜ 10 ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏ß‡∏¥‡∏Å‡∏§‡∏ï‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î</h3>
                <div class="h-[430px]">
                    <canvas id="provinceChart"></canvas>
                </div>
            </div>
        </div>

        <div class="dashboard-card mb-8">
            <h3 class="text-xl font-bold mb-8 italic text-center text-slate-700">üìà ‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå‡πÑ‡∏ü‡∏õ‡πà‡∏≤‡∏£‡∏≤‡∏¢‡∏õ‡∏µ
                (‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®)</h3>
            <div class="h-[380px]">
                <canvas id="trendChart"></canvas>
            </div>
        </div>

        <div class="dashboard-card">
            <h3 class="text-2xl font-bold mb-2 text-center text-slate-800">üìä ‡∏ö‡∏ó‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏£‡∏≤‡∏¢‡∏†‡∏π‡∏°‡∏¥‡∏†‡∏≤‡∏Ñ</h3>
            <p class="text-center text-slate-400 text-sm mb-12">‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á vs
                ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏µ‡∏¢‡∏´‡∏≤‡∏¢</p>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-16 px-4 md:px-12">
                <div class="flex flex-col items-center">
                    <div class="h-[350px] w-full">
                        <canvas id="regionTimesChart"></canvas>
                    </div>
                    <div class="mt-6 bg-orange-100 text-orange-700 px-6 py-2 rounded-full font-bold text-sm uppercase">
                        ‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏≤‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á</div>
                </div>
                <div class="flex flex-col items-center border-l border-slate-100">
                    <div class="h-[350px] w-full">
                        <canvas id="regionRaiChart"></canvas>
                    </div>
                    <div class="mt-6 bg-red-100 text-red-700 px-6 py-2 rounded-full font-bold text-sm uppercase">
                        ‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏≤‡∏°‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏µ‡∏¢‡∏´‡∏≤‡∏¢ (‡πÑ‡∏£‡πà)</div>
                </div>
            </div>

            <div id="custom-legend" class="mt-16 flex flex-wrap justify-center gap-4 pt-10 border-t border-slate-100">
            </div>
        </div>

        <footer class="mt-16 mb-10 text-center text-slate-400 text-sm">
            ‡πÅ‡∏´‡∏•‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: ‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡πÅ‡∏´‡πà‡∏á‡∏ä‡∏≤‡∏ï‡∏¥ | ‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÇ‡∏î‡∏¢ Gemini Dashboard System 2026
        </footer>
    </div>

    <script>
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏õ‡∏•‡∏ä‡∏∑‡πà‡∏≠‡∏†‡∏≤‡∏Ñ
        const translateRegion = (reg) => {
            const mapping = {
                'Northeastern': '‡∏†‡∏≤‡∏Ñ‡∏ï‡∏∞‡∏ß‡∏±‡∏ô‡∏≠‡∏≠‡∏Å‡πÄ‡∏â‡∏µ‡∏¢‡∏á‡πÄ‡∏´‡∏ô‡∏∑‡∏≠',
                'North': '‡∏†‡∏≤‡∏Ñ‡πÄ‡∏´‡∏ô‡∏∑‡∏≠',
                'South': '‡∏†‡∏≤‡∏Ñ‡πÉ‡∏ï‡πâ',
                'Central': '‡∏†‡∏≤‡∏Ñ‡∏Å‡∏•‡∏≤‡∏á'
            };
            return mapping[reg] || reg;
        };

        function getIntensityColor(d) {
            return d > 100000 ? '#7f1d1d' : d > 50000 ? '#b91c1c' : d > 20000 ? '#dc2626' : d > 5000 ? '#f97316' : '#f1f5f9';
        }

        Papa.parse("cleaned_fire_data.csv", {
            download: true, header: true, dynamicTyping: true,
            complete: function (res) { renderDashboard(res.data); }
        });

        function renderDashboard(data) {
            const timesData = data.filter(d => d.UNIT === 'TS');
            const raiData = data.filter(d => d.UNIT === 'RAI');

            // 1. KPI
            const sumT = Math.round(timesData.reduce((s, d) => s + (d.OBS_VALUE || 0), 0));
            const sumR = Math.round(raiData.reduce((s, d) => s + (d.OBS_VALUE || 0), 0));
            document.getElementById('total-times').innerText = sumT.toLocaleString();
            document.getElementById('total-rai').innerText = sumR.toLocaleString();

            const provStats = {};
            raiData.forEach(d => { if (d.Province) { const p = d.Province.trim(); if (!provStats[p]) provStats[p] = { rai: 0, times: 0 }; provStats[p].rai += d.OBS_VALUE; } });
            timesData.forEach(d => { if (d.Province && provStats[d.Province.trim()]) provStats[d.Province.trim()].times += d.OBS_VALUE; });

            // 2. Map
            // 2. Map (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡πÇ‡∏¢‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î)
            const map = L.map('map', { zoomControl: false }).setView([13.8, 100.5], 6);
            L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png').addTo(map);

            // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏±‡∏ß‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏ó‡∏µ‡πà‡∏™‡∏∞‡∏Å‡∏î‡∏ï‡πà‡∏≤‡∏á‡∏Å‡∏±‡∏ô‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á CSV ‡πÅ‡∏•‡∏∞ GeoJSON
            const provinceFix = {
                "Buri Ram": "Buriram",
                "Chon Buri": "Chonburi",
                "Lop Buri": "Lopburi",
                "Prachin Buri": "Prachinburi",
                "Si Sa Ket": "Sisaket",
                "Phra Nakhon Si Ayutthaya": "Ayutthaya"
                // ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡∏ó‡∏µ‡πà‡∏™‡∏µ‡πÑ‡∏°‡πà‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏î‡πâ‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö "‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏ôCSV": "‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏ô‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà"
            };

            fetch('https://raw.githubusercontent.com/apisit/thailand.json/master/thailand.json')
                .then(r => r.json()).then(geo => {
                    L.geoJson(geo, {
                        style: (f) => {
                            const mapName = f.properties.name;
                            // ‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏ô CSV ‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà (‡∏£‡∏ß‡∏°‡∏ñ‡∏∂‡∏á‡∏ï‡∏±‡∏ß‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÉ‡∏ô provinceFix ‡∏î‡πâ‡∏ß‡∏¢)
                            const csvName = Object.keys(provinceFix).find(key => provinceFix[key] === mapName) || mapName;
                            const val = provStats[csvName]?.rai || 0;

                            return {
                                fillColor: getIntensityColor(val),
                                weight: 1,
                                color: 'white',
                                fillOpacity: 0.8
                            };
                        },
                        onEachFeature: (f, l) => {
                            const mapName = f.properties.name;
                            const csvName = Object.keys(provinceFix).find(key => provinceFix[key] === mapName) || mapName;
                            const s = provStats[csvName] || { rai: 0, times: 0 };

                            l.bindPopup(`<div class='font-sarabun'><b>‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î${f.properties.name}</b><br/>üî• ‡πÄ‡∏Å‡∏¥‡∏î‡πÄ‡∏´‡∏ï‡∏∏: ${Math.round(s.times).toLocaleString()} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á<br/>üèîÔ∏è ‡πÄ‡∏™‡∏µ‡∏¢‡∏´‡∏≤‡∏¢: ${Math.round(s.rai).toLocaleString()} ‡πÑ‡∏£‡πà</div>`);
                        }
                    }).addTo(map);
                });

            // 3. ‡∏Å‡∏£‡∏≤‡∏ü‡πÅ‡∏ó‡πà‡∏á Top 10
            const sorted = Object.entries(provStats).sort((a, b) => b[1].rai - a[1].rai).slice(0, 10);
            new Chart(document.getElementById('provinceChart'), {
                type: 'bar',
                data: {
                    labels: sorted.map(p => p[0]),
                    datasets: [
                        { label: '‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà (‡πÑ‡∏£‡πà)', data: sorted.map(p => p[1].rai), backgroundColor: '#ef4444', borderRadius: 5 },
                        { label: '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á', data: sorted.map(p => p[1].times), backgroundColor: '#f97316', borderRadius: 5 }
                    ]
                },
                options: {
                    indexAxis: 'y', responsive: true, maintainAspectRatio: false,
                    plugins: { legend: { labels: { font: { family: 'Sarabun' } } } }
                }
            });

            // 4. ‡∏Å‡∏£‡∏≤‡∏ü‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°‡∏£‡∏≤‡∏¢‡∏õ‡∏µ
            const years = [...new Set(data.map(d => d.TIME_PERIOD))].sort();
            new Chart(document.getElementById('trendChart'), {
                type: 'line',
                data: {
                    labels: years,
                    datasets: [
                        { label: '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á', data: years.map(y => timesData.filter(d => d.TIME_PERIOD === y).reduce((s, d) => s + d.OBS_VALUE, 0)), borderColor: '#f97316', backgroundColor: '#f97316', tension: 0.4 },
                        { label: '‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏µ‡∏¢‡∏´‡∏≤‡∏¢ (‡πÑ‡∏£‡πà)', data: years.map(y => raiData.filter(d => d.TIME_PERIOD === y).reduce((s, d) => s + d.OBS_VALUE, 0)), borderColor: '#ef4444', backgroundColor: 'rgba(239, 68, 68, 0.1)', fill: true, tension: 0.4, yAxisID: 'y1' }
                    ]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    scales: {
                        y: { title: { display: true, text: '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á' } },
                        y1: { position: 'right', title: { display: true, text: '‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà (‡πÑ‡∏£‡πà)' }, grid: { display: false } }
                    },
                    plugins: { legend: { labels: { font: { family: 'Sarabun', weight: 'bold' } } } }
                }
            });

            // 5. ‡∏Å‡∏£‡∏≤‡∏ü‡∏ß‡∏á‡∏Å‡∏•‡∏°‡∏£‡∏≤‡∏¢‡∏†‡∏π‡∏°‡∏¥‡∏†‡∏≤‡∏Ñ
            const rawRegions = [...new Set(data.map(d => d.Area))].filter(r => r);
            const regColors = ['#1e293b', '#e11d48', '#f59e0b', '#10b981', '#3b82f6', '#8b5cf6'];

            // ‡∏™‡∏£‡πâ‡∏≤‡∏á Legend ‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢
            const legendDiv = document.getElementById('custom-legend');
            rawRegions.forEach((reg, i) => {
                legendDiv.innerHTML += `
                    <div class="flex items-center gap-2 bg-white px-5 py-2 rounded-xl border border-slate-100 shadow-sm">
                        <div class="w-4 h-4 rounded-full" style="background:${regColors[i]}"></div>
                        <span class="text-sm font-bold text-slate-700">${translateRegion(reg)}</span>
                    </div>`;
            });

            const pieOpt = {
                responsive: true, maintainAspectRatio: false, cutout: '70%',
                plugins: { legend: { display: false }, tooltip: { callbacks: { label: (ctx) => ` ${translateRegion(ctx.label)}: ${ctx.raw.toLocaleString()}` } } }
            };

            new Chart(document.getElementById('regionTimesChart'), {
                type: 'doughnut',
                data: { labels: rawRegions, datasets: [{ data: rawRegions.map(r => timesData.filter(d => d.Area === r).reduce((s, d) => s + d.OBS_VALUE, 0)), backgroundColor: regColors }] },
                options: pieOpt
            });
            new Chart(document.getElementById('regionRaiChart'), {
                type: 'doughnut',
                data: { labels: rawRegions, datasets: [{ data: rawRegions.map(r => raiData.filter(d => d.Area === r).reduce((s, d) => s + d.OBS_VALUE, 0)), backgroundColor: regColors }] },
                options: pieOpt
            });
        }
    </script>
</body>

</html>


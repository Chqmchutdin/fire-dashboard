<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Forest Fire Executive Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap');
        body { background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%); font-family: 'Plus Jakarta Sans', sans-serif; }
        #map { height: 500px; width: 100%; border-radius: 1.5rem; }
        .kpi-card { transition: transform 0.2s; }
        .kpi-card:hover { transform: translateY(-5px); }
    </style>
</head>
<body class="p-4 md:p-8">
    <div class="max-w-[1440px] mx-auto">
        
        <div class="grid grid-cols-12 gap-6 mb-8">
            <div class="col-span-12 lg:col-span-5 flex flex-col justify-center">
                <h1 class="text-4xl font-extrabold text-slate-900 tracking-tight mb-2">‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡πÑ‡∏ü‡∏õ‡πà‡∏≤‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®</h1>
                <p class="text-slate-500 text-lg">‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏µ ‡∏û.‡∏®. 2542 - 2566</p>
            </div>
            
            <div class="col-span-12 md:col-span-6 lg:col-span-3">
                <div class="kpi-card bg-white p-6 rounded-3xl shadow-sm border border-slate-200">
                    <div class="flex items-center gap-4 mb-2 text-orange-500 uppercase text-xs font-bold tracking-widest">
                        <span>üî• ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡∏¥‡∏î‡πÑ‡∏ü‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</span>
                    </div>
                    <div class="flex items-baseline gap-2">
                        <span id="total-times" class="text-4xl font-black text-slate-800">0</span>
                        <span class="text-slate-400 font-semibold">‡∏Ñ‡∏£‡∏±‡πâ‡∏á</span>
                    </div>
                </div>
            </div>

            <div class="col-span-12 md:col-span-6 lg:col-span-4">
                <div class="kpi-card bg-gradient-to-br from-red-500 to-orange-600 p-6 rounded-3xl shadow-xl border border-red-200">
                    <div class="flex items-center gap-4 mb-2 text-red-100 uppercase text-xs font-bold tracking-widest">
                        <span>üèîÔ∏è ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡∏¢‡∏´‡∏≤‡∏¢‡∏£‡∏ß‡∏°</span>
                    </div>
                    <div class="flex items-baseline gap-2 text-white">
                        <span id="total-rai" class="text-4xl font-black">0</span>
                        <span class="text-red-100 font-semibold italic">‡πÑ‡∏£‡πà</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-12 gap-6 mb-8">
            <div class="col-span-12 lg:col-span-7 bg-white p-6 rounded-[2rem] shadow-sm border border-slate-200">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-lg font-bold text-slate-800">‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏∏‡∏ô‡πÅ‡∏£‡∏á‡∏£‡∏≤‡∏¢‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</h3>
                    <div class="flex gap-2 text-[10px] uppercase font-bold text-slate-400">
                        <span class="px-2 py-1 bg-yellow-100 rounded text-yellow-700">‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏ï‡πà‡∏≥</span>
                        <span class="px-2 py-1 bg-red-100 rounded text-red-700">‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏™‡∏π‡∏á</span>
                    </div>
                </div>
                <div id="map"></div>
            </div>

            <div class="col-span-12 lg:col-span-5 bg-white p-8 rounded-[2rem] shadow-sm border border-slate-200">
                <h3 class="text-lg font-bold text-slate-800 mb-6 italic">Top 10 Critical Provinces</h3>
                <div class="h-[420px]">
                    <canvas id="provinceChart"></canvas>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-12 gap-6">
            <div class="col-span-12 lg:col-span-8 bg-white p-8 rounded-[2rem] shadow-sm border border-slate-200">
                <h3 class="text-lg font-bold text-slate-800 mb-6">‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏£‡∏≤‡∏¢‡∏õ‡∏µ (‡∏Ñ‡∏£‡∏±‡πâ‡∏á vs ‡πÑ‡∏£‡πà)</h3>
                <div class="h-[300px]">
                    <canvas id="trendChart"></canvas>
                </div>
            </div>

            <div class="col-span-12 lg:col-span-4 bg-white p-8 rounded-[2rem] shadow-sm border border-slate-200">
                <h3 class="text-lg font-bold text-slate-800 mb-6">‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏≤‡∏°‡∏†‡∏π‡∏°‡∏¥‡∏†‡∏≤‡∏Ñ</h3>
                <div class="h-[300px]">
                    <canvas id="regionChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- 1. Map Color Intensity ---
        function getIntensityColor(d) {
            return d > 100000 ? '#7f1d1d' :
                   d > 50000  ? '#b91c1c' :
                   d > 20000  ? '#dc2626' :
                   d > 10000  ? '#ef4444' :
                   d > 5000   ? '#f97316' :
                   d > 2000   ? '#fb923c' :
                   d > 500    ? '#facc15' :
                                '#f1f5f9';
        }

        Papa.parse("cleaned_fire_data.csv", {
            download: true,
            header: true,
            dynamicTyping: true,
            complete: function(res) {
                renderDashboard(res.data);
            }
        });

        function renderDashboard(data) {
            const timesData = data.filter(d => d.UNIT === 'TS');
            const raiData = data.filter(d => d.UNIT === 'RAI');

            // --- KPI Calculation (Integers) ---
            const sumTimes = Math.round(timesData.reduce((s, d) => s + (d.OBS_VALUE || 0), 0));
            const sumRai = Math.round(raiData.reduce((s, d) => s + (d.OBS_VALUE || 0), 0));

            document.getElementById('total-times').innerText = sumTimes.toLocaleString();
            document.getElementById('total-rai').innerText = sumRai.toLocaleString();

            // --- 2. Map Render ---
            const provMapData = {};
            raiData.forEach(d => { if(d.Province) provMapData[d.Province.trim()] = (provMapData[d.Province.trim()] || 0) + d.OBS_VALUE; });

            const map = L.map('map', {zoomControl: false}).setView([13.8, 100.5], 6);
            L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png').addTo(map);

            fetch('https://raw.githubusercontent.com/apisit/thailand.json/master/thailand.json')
                .then(r => r.json())
                .then(geo => {
                    L.geoJson(geo, {
                        style: (f) => ({
                            fillColor: getIntensityColor(provMapData[f.properties.name] || 0),
                            weight: 1, color: 'white', fillOpacity: 0.85
                        }),
                        onEachFeature: (f, l) => {
                            const v = Math.round(provMapData[f.properties.name] || 0);
                            l.bindPopup(`<b>‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î: ${f.properties.name}</b><br>‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏µ‡∏¢‡∏´‡∏≤‡∏¢‡∏£‡∏ß‡∏°: ${v.toLocaleString()} ‡πÑ‡∏£‡πà`);
                        }
                    }).addTo(map);
                });

            // --- 3. Top 10 Provinces Chart (With Grid Lines) ---
            const sortedProv = Object.entries(provMapData).sort((a,b) => b[1] - a[1]).slice(0, 10);
            new Chart(document.getElementById('provinceChart'), {
                type: 'bar',
                data: {
                    labels: sortedProv.map(p => p[0]),
                    datasets: [{
                        label: '‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏µ‡∏¢‡∏´‡∏≤‡∏¢ (‡πÑ‡∏£‡πà)',
                        data: sortedProv.map(p => p[1]),
                        backgroundColor: '#ef4444',
                        borderRadius: 12
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        x: { 
                            grid: { color: 'rgba(0,0,0,0.05)', display: true }, // ‡πÄ‡∏™‡πâ‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á
                            ticks: { font: { size: 10 } }
                        },
                        y: { 
                            grid: { display: false }, // ‡∏ã‡πà‡∏≠‡∏ô‡πÄ‡∏™‡πâ‡∏ô‡πÅ‡∏ô‡∏ß‡∏ô‡∏≠‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏î‡∏π‡∏Ñ‡∏•‡∏µ‡∏ô
                            ticks: { font: { weight: 'bold' } }
                        }
                    }
                }
            });

            // --- 4. Yearly Trend Chart ---
            const years = [...new Set(data.map(d => d.TIME_PERIOD))].sort();
            new Chart(document.getElementById('trendChart'), {
                type: 'line',
                data: {
                    labels: years,
                    datasets: [
                        { label: '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á', data: years.map(y => timesData.filter(d => d.TIME_PERIOD === y).reduce((s,d) => s+d.OBS_VALUE,0)), borderColor: '#f97316', backgroundColor: '#f97316', tension: 0.4 },
                        { label: '‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà (‡πÑ‡∏£‡πà)', data: years.map(y => raiData.filter(d => d.TIME_PERIOD === y).reduce((s,d) => s+d.OBS_VALUE,0)), borderColor: '#ef4444', backgroundColor: '#ef4444', tension: 0.4, yAxisID: 'y1' }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: { 
                        y: { grid: { color: 'rgba(0,0,0,0.03)' } },
                        y1: { position: 'right', grid: { display: false } }
                    }
                }
            });

            // --- 5. Region Chart ---
            const regions = [...new Set(data.map(d => d.Area))].filter(r => r);
            new Chart(document.getElementById('regionChart'), {
                type: 'doughnut',
                data: {
                    labels: regions,
                    datasets: [{
                        data: regions.map(r => raiData.filter(d => d.Area === r).reduce((s, d) => s + d.OBS_VALUE, 0)),
                        backgroundColor: ['#0f172a', '#e11d48', '#f59e0b', '#10b981', '#6366f1']
                    }]
                },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom' } } }
            });
        }
    </script>
</body>
</html>